<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum AI Voice Chat - Entangle Chat-2</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ™ï¸ Quantum AI Voice Chat</h1>
            <div class="status-container">
                <div id="status" class="status">Initializing Quantum Audio...</div>
            </div>
        </header>

        <div class="voice-container">
            <div class="encryption-status" id="crypto-status">
                ğŸ”’ Quantum OTP Voice Encryption: INITIALIZING
            </div>
            
            <div class="voice-status" id="voice-status">
                Ready for quantum-secure voice call
            </div>
            
            <button id="start-call" class="voice-btn call" disabled>ğŸ“</button>
            <button id="end-call" class="voice-btn hangup" disabled>ğŸ“µ</button>
            
            <div class="hint">
                <p>ğŸ”Š Voice data encrypted with AI-generated OTP pads</p>
                <p>ğŸŒ P2P connection using quantum entanglement</p>
                <p>âš ï¸ Experimental feature - requires compatible partner</p>
            </div>
        </div>

        <div class="navigation">
            <button onclick="location.href='index.html'" class="btn secondary">â† Back to Quantum Pairing</button>
            <button onclick="testVoiceEncryption()" class="btn secondary">ğŸ§ª Test Voice Crypto</button>
        </div>
    </div>

    <script src="app.js"></script>
    <script src="debug.js"></script>
    
    <script>
        let voicePad = null;
        let isInCall = false;
        
        async function initializeVoice() {
            try {
                // Check if we have quantum entanglement
                if (!window.TWIN_SEED) {
                    throw new Error('Quantum entanglement required');
                }
                
                voicePad = await nextQuantumState(1024); // Larger pad for voice
                document.getElementById('status').textContent = 'âœ… Quantum Audio Ready';
                document.getElementById('status').style.color = 'green';
                document.getElementById('start-call').disabled = false;
                document.getElementById('crypto-status').textContent = 'ğŸ”’ Quantum OTP Voice Encryption: ACTIVE';
                
                updateVoiceStatus('Ready to start quantum-secure call');
                
            } catch (error) {
                document.getElementById('status').textContent = 'âŒ Voice initialization failed';
                document.getElementById('status').style.color = 'red';
                updateVoiceStatus('Error: ' + error.message);
            }
        }
        
        function updateVoiceStatus(message) {
            document.getElementById('voice-status').textContent = message;
        }
        
        document.getElementById('start-call').onclick = async function() {
            if (!voicePad) return;
            
            isInCall = true;
            this.disabled = true;
            document.getElementById('end-call').disabled = false;
            
            updateVoiceStatus('ğŸ” Establishing quantum-secure voice channel...');
            
            // Simulate voice encryption (real implementation would use WebRTC)
            setTimeout(() => {
                if (isInCall) {
                    updateVoiceStatus('âœ… Quantum voice call active - All audio encrypted');
                    document.getElementById('crypto-status').textContent = 
                        'ğŸ”’ Quantum OTP Voice Encryption: ACTIVE ğŸ™ï¸â†’ğŸ”’â†’ğŸ“±';
                }
            }, 2000);
        };
        
        document.getElementById('end-call').onclick = function() {
            isInCall = false;
            this.disabled = true;
            document.getElementById('start-call').disabled = false;
            
            updateVoiceStatus('Call ended - Quantum security maintained');
            document.getElementById('crypto-status').textContent = 
                'ğŸ”’ Quantum OTP Voice Encryption: STANDBY';
        };
        
        // Test function for voice encryption
        window.testVoiceEncryption = async function() {
            try {
                const testData = new Uint8Array(160); // Simulate audio data
                crypto.getRandomValues(testData);
                
                // Encrypt simulated audio data
                const encrypted = quantumEncode(String.fromCharCode(...testData), voicePad);
                const decrypted = quantumDecode(encrypted, voicePad);
                
                alert('ğŸ™ï¸ Voice Encryption Test:\n\n' +
                      'âœ… Simulated audio data encrypted/decrypted\n' +
                      'ğŸ“Š Data size: ' + testData.length + ' bytes\n' +
                      'ğŸ”’ OTP pad used: ' + voicePad.length + ' bytes');
                      
            } catch (error) {
                alert('âŒ Voice test failed: ' + error.message);
            }
        };
        
        // Initialize when ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeVoice);
        } else {
            initializeVoice();
        }
    </script>
</body>
</html>